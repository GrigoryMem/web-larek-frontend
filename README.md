# Проектная работа "Веб-ларек"

<!-- Проверить структура проекта -->

Стек:

- Язык: TypeScript
- Архитектура: MVP
- Сборка: Webpack
- Среда: браузер
- Стили: SCSS

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

ПРОВЕРЬ!!!!!!!!!!!!!!!!!!!!!

Данные объекта карточки товара, получаемые с сервера

```
interface IProduct {
  id: string,
  description: string,
  image: string,
  title: string,
  category: string,
  price:number | null;
}

```

Состав заказа включает данные пользователя (которые отправляются на сервер при оформлении заказа)

```
interface IOrder {
  payment: string,
  email: string,
  phone: string,
  address: string,
  total: number,
  items: string[]
}

```

Данные продукта с отметкой о наличии товара в корзине

```
interface IProductWithCart extends Omit<IProduct,'price'> {
  isInCart?: boolean;
  price: number | string;
}

```

Товар, добавленный в корзину:

```
interface IGoodInBasket extends Omit<IProduct , 'isInCart'>{}

```

Id карточки товара

```
type idGood = string;

```

Тип оплаты:

```
type TPayment = 'cash' | 'card' | 'Выберите способ оплаты';

```

Короткая типизация карточки для отображения массива карточек на главной странице

```

  type TShortCardProduct = Pick<IProductWithCart,'title' | 'category' | 'price' | 'image'>

```

При открытии модального окна подробного описания карточки товарa

```
type TBaseCardProduct = Pick<IProductWithCart,'title' | 'description' | 'category' | 'price' | 'image'| 'isInCart'| 'id'>

```

Данные пользователя, необходимые для оформления заказа:

1. Для форма заполнения адреса и способа олпаты:

```
type TBuyerInfo = Pick<IOrder,'address' | 'payment'>;

```

2. Для формы выбора адреса и телефона:

```
type TBuyerContacts = Pick<IOrder, 'phone' | 'email'>;

```

3. Типы полей формы

```
type OrderFields = Partial<TBuyerInfo & TBuyerContacts>
```

Интерфейс модели данных для карточе ктоваров

```
interface CatalogModel {
  cards: IProductWithCart[];
  preview: string | null;
  total:number;
  toggleInCart(id:string,toggle:boolean):void
  setPreview(id:string):void;
  setCards(cards:IProduct[]):void
  getProduct(id:string):void // чтобы получить при рендере списков
}


```

// Интерфейс товара в корзине

```

interface GoodInBasket {
  total:number,
  price:number,
  title:string
}

```

Интерфейс для модели данных добавленных в корзину товаров

```

interface IBasketModel {
  add(id:string,product: GoodInBasket):void
  remove(id:string):void;
  setOrderField(field:IOrderFields, value:string):void;
  validateOrder():boolean;
  updateOrderItems():void;
  clearBasket():void;
  getTotalSum(): number;
  getReadyOrder():IOrder
}

```

## Архитектура приложения

Архитектура проекта разрабатыватся с учетом паттерна MVP, в котором основными слоями являются: M - это model т.е. слой модели данных, V или View - это слой комопнентов представления, отвечающий за отображения компонентов на экране, предназначенных непосредственно для взаимодействия с пользователем. И P - это Presenter, код презентера не будет выделен в отдельный класс, а будет содержаться в основном скрипте приложения index.ts. Presenter управляет логикой работы всего приложения.
В приложении так же используется событийно-ориентированный подход, реализуемый посредством класса EventEmmiter. Т.е. любые изменения в приложении связаны с возникновением какого-то события.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Классы слоя модели данных

#### Класс Model

Класс является абстрактным родительским базовым классом для все моделей данных в приложении.
Конструктор класса принимает: data получает исходные данные типа Partial<T> и экземпляр брокера событий класса EventEmitter.
В дженерик принимается тип объекта T указывает,какие данные будут храниться в кокретной модели т.е. шаблон модели данных, Partial означает частичную передачу свойств объекта T
Object.assign(this, data) в конструкторе копирует все свойства объекта data.
Имеет поле events для хранения брокера событий интерфейса`IEvents
Класс предоставляет один метод:
emitChanges(event: string, payload?: object) - данный метод дает возможность сообщить другим комопнентам(слоям приложения),что что-то
поменялось в модели данных т.е генерирует определеннын события, описанные ниже, используя поле events

#### Класс CardsModel

Класс отвечает за хранение и логику работы с данными карточек товаров,которые может посмотреть или купить пользователь. Класс наследуется от родительского класса Model<IICardData>.
В полях класса хранятся следующие данные:

- \_total:number - общее количество товаров доступных к покупке или просмотре на странице
- \_cards:IProductWithCart[] - массив объектов карточек с отметкой о наличии/ отсутствии товара в корзине
- preview:string | null; id карточки, выбранной для просмотра или возможности покупки в модальном окне

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- setPreview(id:string):void - принимает id карточки товара и устанавливается его в поле preview.
- toggleInCart(id:string,toggle:boolean) - принимает id объекта карточки товара и отмечает, что этот объект товара был добавлен в корзину или нет, используя поле isInCart: boolean;
- метод setCards(cards:IProduct[]) - принимает массив карточек товаров IProduct[] и устанавливает в поле \_cards массив IProductWithCart[] с отметкой isInCart: boolean, подсказывающей есть ли товар в корзине;
- getProduct(id:string):IProductWithCart|undefined - получает одну карточку из списка карточек, по id параметру
- геттер cards():IProductWithCart[] будет получать карточки с отметкой о том, есть ли товар в корзине;
- сеттер get total():number - возвращает количество карточек содержащихся в модели данных.

#### Класс BasketModel

Класс отвечает за хранение и логику работы с данными товаров,которые пользователь добавил в корзину,формирование заказа, валидацию полей заказа, Класс наследуется от родительского класса Model<IBasketModel>
Поля класса:

-\_items:Map<idGood,GoodInBasket> - хранит коллекцию Map<ключ/значение>, где ключ idGood:string это id товара, GoodInBasket - количество товара и его стоимость и название

- \_order:IOrder - объект заказа интерфейса IOrder, включает список покупок и данные пользователя
- formErrors: TOrderForm ={} - хранение ошибок если поля заказа order не прошли валидацию;
  Конструктор класса принимает пустой объект и экземпляр брокера событий EventEmitter Служит для инициализации поля \_items как 'экземпляра коллекции Map<idGood,GoodInBasket>
  Методы класса:
- add(id:string): void - добавляет товар в поле \_items;
- remove(id:string):void; - удаляет товар из поля \_items;
- setOrderField(field:IOrderFields, value:string):void - принимает имя поля заказа и значение чтобы затем заполнить поле заказа этим значением и провести валидацию.
- validateOrder():boolean проверяет валидацию полей, где хранятся данные пользователя
- updateOrderItems():void - добавляет массив тооваров которые хранятся в корзине в данные по заказазу когда срабатывает событие создать заказ
  -getTotalSum(): number - высчитывает итоговую стоиость заказа
  -clearBasket():void очищает корзину
- clearOrder():void - очищает данные заказа
  changed()- сообщает об изменении данных корзины в поле items
- геттер get items():GoodInBasket[] - получает все товара хранящиесяв корзине

### Классы слоя представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component

Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента.
Методы класса:

- render(data?: Partial<T>): HTMLElement- отвчевает за сохранение полученных в параметре данных типа : Partial<T> в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.
- toggleClass(element: HTMLElement, className: string, force?: boolean) - переключает класс HTML эелмента. В параметре передается сам HTMLElement, класс который нужно добавить или убрать с этого элемента и необязательный параметр force чтобы метод работал только на добавление или удаление класса у элемента.
- setText(element: HTMLElement, value: unknown) - устанавливает текст value в переданный HTMLElement
  setDisabled(element: HTMLElement, state: boolean) - устанавливает или удаляет атрибут disabled в зависимости от переданного state
- setHidden(element: HTMLElement) - убирает HTMLElement из поля видимости.
- setImage(element: HTMLImageElement, src: string, alt?: string) -устанавливает путь к картинке

#### Класс PageContainer

Отвечат за отображение всех элементов страницы приложения.
Поля класса:

- \_counter: HTMLElement - cчётчик товаров в корзине
- \_catalog: HTMLElement - cписок товаров (каталог)
- \_wrapper: HTMLElement - Обёртка всей страницы
- \_basket: HTMLButtonElement; - Иконка корзины (кнопка)
  В конструктор передается контейнер типа HTMLElement,в котором размещаются карточки и иконка корзины и брокер событий IEvents. В нем определяем поля класса и ставим обработчик на кнопку корзины.
  Сеттеры класса:
- counter(value: number) - устанавливает число добавленных товаров в корзину товаров;
- catalog(items: HTMLElement[]) - устанавливаем карточки товаров в раздел каталога для карточек;
- set locked(value: boolean) - блокируем странице когда это необходимо.

В методе render принимает объект интерфейса IPageContainer, который содержит в себе массив карточек -элементов разметки карточек, который отображает в контейнере, за который отвечает,счетчик козрины, и поле для блокировки страницы для взаимодействия через метод render родительского класса с сеттерами дочернего класса PageContainer

#### Класс Modal

Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна и сеттер для установки основного содержания конкретного модального окна. Устанавливает слушатели для закрытия модального окна по клику вне модального окна и на клик в оверлей и кнопку-крестик для закрытия попапа.
В дженерик родителя передается Component<IModalData>.

- constructor(container: HTMLElement, protected events: IEvents) Конструктор принимает HTMLElement, по которому в его разметке будут найдены элементы для взаимодействия с модальным окном и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса

- \_closeButton: HTMLButtonElement - для кнопки закрытия модального окна;
- container: HTMLElement - элемент модального окна;
- events: IEvents - брокер событий;
- \_content: HTMLElement - поле для хранения данных конкретного модального окнаж

#### Класс Card<T>

В приложении применяется абстрактный класс Card<T> для отображения карточек. Который задает общие свойства и сеттеры для обозначения карточек в каталоге товаров на странице,карточки подробного просмотра и карточки, добавленного в корзину товара.
Card<T>, где T дженерик - тип карточки, в котором данные будут передаваться в метод render для отображения данных в компоненте.
Конструктор класса принимает container: HTMLElement карточки и опредлеяет через него нижеуказанные поля title и price:
\_cardId:string - id карточки товара;
\_title: HTMLElement - название товара;
\_price: HTMLElement - цена товара
и реализует соответствующие сеттеры для заполнения этих полей.

##### Класс CardPreview<T>

Второй абстрактный класс карточки который наследуется от класса Card. Назначение дженерика как и у класса родителя Card.
Тип T это тип карточки с определенными полями, который должны быть заполнены при отображении.
Устанавливает общие поля для карточки каталога и карточки детального просмотра товара:
\_category: HTMLElement - категория товара;
\_image: HTMLImageElement - изображение товара;
Так же реализует соответствующие сеттеры для заполнения этих полей.

##### Класс ShortCard

Отвечает за отображение карточки товарав каталоге. Наследуется от абстрактного класса CardPreview.
Конструктор класса принимает кроме container: HTMLElement разметки карточки, обработчик клика на саму карточку IShortCardActions.

##### Класс DetailedCard

Отвечает за отображение карточки при клике на карточку в каталоге для ее детального просмотра. Наследуется от CardPreview<T>
Конструктор класса принимает container: HTMLElement разметку карточки, и обработчик
клика по кнопке карточки IDetailedCardActions.
В конструктор определяет ниже описанные поля и устанавливает переданный обработчик на кнопку карточки.
Поля класса:

- \_description: HTMLElement - описание товара;
- \_button: HTMLElement - кнопка добавить или удалить товар;
- \_isInCart = false - метка о наличии/отсутствии товарав корзине;
  Класс имеет сеттеры для заполения этих полей через метод render, наследуемого от класса Component.

##### Класс BasketCard

Отвечает за отображение карточки товара,который был добавлен пользователем в корзину.
Наследуется от Card<T>
Конструктор класса принимает container: HTMLElement разметку карточки, и обработчик
клика по кнопке карточки IBasketCardActions.
В конструктор определяет ниже описанные поля и устанавливает переданный обработчик на кнопку удаления карточки.
Поля класса:

- \_button: HTMLElement- кнопка удаления из корзины;
- \_index:HTMLElement - определяет порядковый нмоер товара
  Класс имеет сеттер и геттер для поля \_index

#### Класс PageContainer

Отвечает за отображение блока с карточками на главной странице и иконки корзины,счетчика товаров у иконки корзины.
Конструктор класса принимает container: HTMLElement - страницу для отображения всех элементов и брокер событий IEvents
Поля класса:

- _counter: HTMLElement; - Счётчик товаров в корзине
- _catalog: HTMLElement; - Список товаров (каталог)
- _wrapper: HTMLElement; - Обёртка всей страницы
- _basket: HTMLElement; - иконка корзины (кнопка)

В конструктор принимает контейнер HTMLElement, в котором размещаются карточки и брокер событий типа IEvents. Конструктор инициализирует поля класса и вешает обработчик на иконку корзины который инициирует событие открытие корзины.

Сеттер counter устанавливает число товаров
Сеттер catalog добавляет карточки товаров в каталог просмотра
Сеттер locked - блокирует страницу во время просмотра карточки

#### Класс BasketView

Отвечает за отображение блока с карточками добавленных в корзину.
Конструктор класса принимает container: HTMLElement - разметку корзины и функцию обработчик IBasketViewActions.
В конструктор определяет ниже описанные поля и устанавливает переданный обработчик на кнопку оформления заказа
Поля класса:
- _items:HTMLElement - список карточек добавленных товаров;
-  _totalPrice:HTMLElement - итоговая стоимость всех товаров;
- _button:HTMLElement; - кнопка оформления заказа
Имеет сеттеры для заполнения полей _items и _totalPrice интерфейса IBasketView


#### Класс Form<T>

YНаследуется от класса Component. Предназначен для отображения формы, содержащей поля ввода. Является абстрактым классом для всех форм данного приложения.
Конструктор класса принимает container: HTMLElement - разметку формы и брокер событий IEvents
В конструктор определяет ниже описанные поля и устанавливает переданный обработчик на кнопку оформления заказа
В конструкторе определяются поля:
- _submit: HTMLButtonElement - Кнопка для отправки данных формы;
  -_errors: HTMLElement - поле дл ошибок полей формы
Инициирует обработку событий отправки формы и введение данных пользователем в конкрентое поле
  Методы:
  onInputChange(field: keyof T, value: string) - сообщает о событии изменения поле ввода
  Сеттеры:
  valid(value: boolean) - блокирует кнопку отправки формы
  errors(value: string) - устанавливает данные в поле для ошибки
  render(state: Partial<T> & IFormState) - метод, где state: Partial<T> T определяет имена полей ввода формы  - обрабатываются прямо в этом методе, а IFormState - поля для сеттеров errors - объект ошибок  и valid - блокировка кнопки,которые передаются родителю Component для отображения.

#### Класс FormOrder

Наследуется от  класса Form<T>. Предназначен для отображения формы, содержащей поля ввода адреса и типа оплаты интерфейса TBuyerInfo, который передается в джерерик родителя Form<T>.
Конструктор класса принимает container: HTMLElement - разметку формы и брокер событий IEvents
В конструктор определяет ниже описанные поля и устанавливает переданный обработчик на кнопку оформления заказа
В конструкторе определяются поля:
- _paymentButtons:  HTMLElement; - кнопки переключения типа оплаты: при получении или онлайн. В  конструкторе классана них устанавливается обработчик клика дя определния способа оплаты 
Класс имеет сеттеры адреса и типа оплаты для программного заполнения соответствуюших полей ввода.

#### Класс FormContacts

Наследуется от  класса Form<T>. Предназначен для отображения формы, содержащей поля ввода телефона и электронной почты пользователя  интерфейса TBuyerContacts, который передается в джерерик родителя Form<T>.
Конструктор класса принимает container: HTMLElement - разметку формы и брокер событий IEvents
Класс имеет сеттеры почты и телефона для программного заполнения соответствуюших полей ввода.


### Класс Success 

Класс предназначен для отображения результата отправки заказа на сервер, когда пользователь ввел данные и хочет отправить заказ. Сообщает пользователе о статусе заказа.
Конструктор класса принимает container: HTMLElement - разметку и ообработчик ISuccessActions
В конструктор определяет ниже описанные поля и устанавливает переданный обработчик на кнопку продолжить покупки
Поля класса:
 _totalPrice:HTMLElement - стоимость заказа;
 _button:HTMLElement - кнопка закрытия окна
_title:HTMLElement - сообщение;
Cеттеры:
set totalPrice(value:number) - устанавливает стоимость заказа;
set titleError(data:TErorr )  - сообщает об ошибке сервера если запрос на заказ был отклонен.

## Слой презентера

Код презентера не будет выделен в отдельный класс, а будет размещен в основном скрипте приложения

### Слой коммуникации

## Взаимодействие компонентов

## Api

Класс Api - базовый класс для отправления get и post запросов на сервер приложения.

#### Класс AppApi

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
Конструктор принимает следующие параметры:

- cdn: string - адрес, где хранятся изображения;
- baseApi:IApi - экземпляр класса Api,который должен соответстовать интерфейсу IApi
  Методы:
- getAllCards():Promise<IProduct[]> - получает список всех карточек товаров с сервера;
- getCard(id:string):Promise<IProduct> - получает одну карточку;
- sendOrder(order:IOrder):Promise<IOrderResult> - отправляет данные заказа на сервер приложение и при успешном результате вернет промис IOrderResult;

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_\
\_События изменения данных (генерируются классами моделями данных)
Модели данныx:
- Карточки
`cards:changed` - изменение массива карточек;
`card:select` -сообщаем, что карточка была кликнута,чтобы установить карточку в поле preview модели данных
`preview:changed` - событие изменения поля преаью модели данных - для откытия модального окна с текущей карточкой

Компоненты отображения:
Корзина:
`basket:open` - событие, когда пользователь кликает иконку корзины на странице

`formErrors:change` - добавиление ошибок в модели данных если есть ошибки взаполнении полей форм

Данные по заказу
`order:open` - пользователь нажал кнопку оформить заказ с добавленными товарами

`order:submit` - пользователь продолжил оформлять заказ заполнив форму с типом оплаты и адресом доставки.
`contacts:submit` - пользователь отправляет  заказ заполнив форму с эл.почтой и телефоном.

События формы
`^${nameForm}\\..*:change` - уведомляем об изменении поля ввода.

Вью компоненты
Корзина
`basket:open` - открытие корзины товарами

Модальное окно
`modal:open` - открытие модального окна
`modal:close` - закрытие модального окна



