# Проектная работа "Веб-ларек"

<!-- Проверить структура проекта -->

Стек:

- Язык: TypeScript
- Архитектура: MVP
- Сборка: Webpack
- Среда: браузер
- Стили: SCSS

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

ПРОВЕРЬ!!!!!!!!!!!!!!!!!!!!!

Данные объекта карточки товара, получаемые с сервера

```
interface IProduct {
  id: string,
  description: string,
  image: string,
  title: string,
  category: string,
  price:number | null;
}

```

Состав заказа включает данные пользователя (которые отправляются на сервер при оформлении заказа)

```
interface IOrder {
  payment: TPayment,
  email: string,
  phone: string,
  address: string,
  total: number,
  items: TIdProduct[]
}

```

Данные продукта с отметкой о наличии товара в корзине

```
 interface IProductWithCart extends Omit<IProduct,'price'> {
  isInCart?: boolean;
  price: number | string;
}

```

Товар, добавленный в корзину:

```
 interface IGoodInBasket extends Omit<IProduct , 'isInCart'>{}

```

Id карточки товара

```
type TIdProduct = Pick<IProduct,'id'> // id карточки

```

Тип оплаты:

```
type TPayment = 'cash' | 'online';

```

Короткая типизация карточки для отображения массива карточек на главной странице

```

 type TShortCardProduct = Pick<IProduct,'title' | 'category' | 'price' | 'image'>

```

При открытии модального окна подробного описания карточки товарa

```
type TBaseCardProduct = Pick<IProductWithCart,'title' | 'description' | 'category' | 'price' | 'image'| 'isInCart'>

```

Данные пользователя, необходимые для оформления заказа:

1. Для форма заполнения адреса и способа олпаты:

```
type TBuyerInfo = Pick<IOrder,'address' | 'payment'>;

```

2. Для формы выбора адреса и телефона:

```
type TBuyerContacts = Pick<IOrder, 'phone' | 'email'>;

```

3. Типы полей формы

```
type OrderFields = Partial<TBuyerInfo & TBuyerContacts>
```

Список товаров доступных для просмотра на главной странице

```
interface ICardProdList {
  items:TShortCardProduct[]
}

```

// Интерфейс товара в корзине

```

export interface IGoodInBasket extends Omit<IProduct ,'price'>{
  price: number
}

```

Интерфейс для модели данных добавленных в корзину товаров

<!-- переделать код ниже -->

```

interface IBasketModel {
  add(id:string): void;
  remove(id:string):void;
  clear():void;
  validateOrder():boolean;
  addCardsInOrder(id: string, isIncluded: boolean):void
}

```

Интерфейс данных для передачи их в модальное окно:

```

interface IModalData {
    content: HTMLElement;
}

```

Интерфейс для определния состояния формы, валидна она или нет и какие ошибки заполнения:

```

interface IFormState {
    valid: boolean;
    errors: string | string[];
}

```

## Архитектура приложения

Архитектура проекта разрабатыватся с учетом паттерна MVP, в котором основными слоями являются: M - это model т.е. слой модели данных, V или View - это слой комопнентов представления, отвечающий за отображения компонентов на экране, предназначенных непосредственно для взаимодействия с пользователем. И P - это Presenter, код презентера не будет выделен в отдельный класс, а будет содержаться в основном скрипте приложения index.ts. Presenter управляет логикой работы всего приложения.
В приложении так же используется событийно-ориентированный подход, реализуемый посредством класса EventEmmiter. Т.е. любые изменения в приложении связаны с возникновением какого-то события.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Классы слоя модели данных

#### Класс Model

Класс является абстрактным родительским базовым классом для все моделей данных в приложении.
Конструктор класса принимает: data получает исходные данные типа Partial<T> и экземпляр брокера событий класса EventEmitter.
В дженерик принимается тип объекта T указывает,какие данные будут храниться в кокретной модели т.е. шаблон модели данных, Partial означает частичную передачу свойств объекта T
Object.assign(this, data) в конструкторе копирует все свойства объекта data.
Имеет поле events для хранения брокера событий интерфейса`IEvents
Класс предоставляет один метод:
emitChanges(event: string, payload?: object) - данный метод дает возможность сообщить другим комопнентам(слоям приложения),что что-то
поменялось в модели данных т.е генерирует определеннын события, описанные ниже, используя поле events

#### Класс CardsModel

Класс отвечает за хранение и логику работы с данными карточек товаров,которые может посмотреть или купить пользователь. Класс наследуется от родительского класса Model<IICardData>.
В полях класса хранятся следующие данные:

- \_total:number - общее количество товаров доступных к покупке или просмотре на странице
- \_cards:IProductWithCart[] - массив объектов карточек с отметкой о наличии/ отсутствии товара в корзине
- \_preview:string | null; id карточки, выбранной для просмотра или возможности покупки в модальном окне

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- setPreview(id:string):void - принимает карточку товара с полем о наличии в корзине и устанавливает id карточки доступной для просмотра в модальном окне;
- toggleInCart(id:string,toggle:boolean) - принимает id объекта карточки товара и отмечает, что этот объект товара был добавлен в корзину или нет, используя поле isInCart: boolean;
- метод setCards(cards:IProduct[]) - принимает массив карточек товаров IProduct[] и устанавливает в поле \_cards массив IProductWithCart[] с отметкой isInCart: boolean, подсказывающей есть ли товар в корзине?;
- геттер cards():IProductWithCart[] будет получать карточки с отметкой о том, есть ли товар в корзине;
- getProduct(id:string):IProductWithCart|undefined - получает одну карточку из списка карточек
- сеттер get total():number - возвращает количество карточек содержащихся в модеил данных

#### Класс BasketModel

Класс отвечает за хранение и логику работы с данными товаров,которые пользователь добавил в корзину,формирование заказа, валидацию полей заказа, Класс наследуется от родительского класса Model<IBasketModel>
Поля класса:

-\_items:Map<string,GoodInBasket> - хранит коллекцию Map<ключ/значение>, где ключ string это id товара, GoodInBasket - количество товара и его стоимость

- \_order:IOrder | null; - объект заказа интерфейса IOrder, включает список покупок и данные пользователя
  formErrors: TOrderForm ={} - хранение ошибок если поля заказа order не прошли валидацию
  Конструктор класса инициализирует поле \_items как 'экземпляр коллекции Map<string,GoodInBasket>
  Методы класса:
- add(id:string): void - добавляет товар в поле \_items;
- remove(id:string):void; - удаляет товар из поля \_items;
- get items():GoodInBasket[] - получает все товара хранящиесяв корзине
- setOrderField(field:IOrderFields, value:string):void - приниает имя поля заказа и значение чтобы затем заполнить поле заказа этим значением.
- validateOrder():boolean проверяет валидацию полей, где хранятся данные пользователя

- updateOrderItems():void - добавляет массив тооваров которые хранятся вкорзине в данные по заказазу когда срабатывает событие создать заказ
  -getTotalSum(): number - высчитывает итоговую стоиость заказа
  -clearBasket():void очищает корзину
- \_clearOrder():void - очищает данные заказа
  \_changed()- сообщает об изменении данных корзины в поле items

### Классы слоя представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component

Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента.
Методы класса:

- render(data?: Partial<T>): HTMLElement- отвчевает за сохранение полученных в параметре данных типа : Partial<T> в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.
- toggleClass(element: HTMLElement, className: string, force?: boolean) - переключает класс HTML эелмента. В параметре передается сам HTMLElement, класс который нужно добавить или убрать с этого элемента и необязательный параметр force чтобы метод работал только на добавление или удаление класса у элемента.

#### Класс PageContainer

Отвечат за отображение всех элементов страницы приложения.
Поля класса:

- \_counter: HTMLElement - cчётчик товаров в корзине
- \_catalog: HTMLElement - cписок товаров (каталог)
- \_wrapper: HTMLElement - Обёртка всей страницы
- \_basket: HTMLButtonElement; - Иконка корзины (кнопка)
  В конструктор передается контейнер типа HTMLElement,в котором размещаются карточки и иконка корзины и брокер событий IEvents. В нем определяем поля класса и ставим обработчик на кнопку корзины.
  Сеттеры класса:
- counter(value: number) - устанавливает число добавленных товаров в корзину товаров;
- catalog(items: HTMLElement[]) - устанавливаем карточки товаров в раздел каталога для карточек;
- set locked(value: boolean) - блокируем странице когда это необходимо.

В методе render принимает объект интерфейса IPageContainer, который содержит в себе массив карточек -элементов разметки карточек, который отображает в контейнере, за который отвечает,счетчик козрины, и поле для блокировки страницы для взаимодействия через метод render родительского класса с сеттерами дочернего класса PageContainer

#### Класс Modal

Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна и сеттер для установки основного содержания конкретного модального окна. Устанавливает слушатели для закрытия модального окна по клику вне модального окна и на клик в оверлей и кнопку-крестик для закрытия попапа.
В дженерик родителя передается Component<IModalData>.

- constructor(container: HTMLElement, protected events: IEvents) Конструктор принимает HTMLElement, по которому в его разметке будут найдены элементы для взаимодействия с модальным окном и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса

- \_closeButton: HTMLButtonElement - для кнопки закрытия модального окна;
- container: HTMLElement - элемент модального окна;
- events: IEvents - брокер событий;
- \_content: HTMLElement - поле для хранения данных конкретного модального окнаж

#### Класс Card<T>

В приложении применяется абстрактный класс
есть абстрактный класс Card

 <!-- для модели
можно класс карточек, класс корзины, класс юзера
можно расширенный класс карточек с доп полями корзины , класс юзера

Представление: определиться какие элементы разметки являются интерактивными(напр кнопки с кот взаимодействует пользователь) и динамически изменяеными - поля класса -->

Отвечает за отображение карточки и является абстрактным родительским классом для всех вариантов отображения карточки товара (в каталоге, корзине, в окне подробного просмотра и др).
Поля класса:

- \_title:HMLElement для названия товара;
- \_id: string - уникальный идентифиатор товара;
- price: HMLElement - для цены товара;
- button?: HMLElement - кнопка обработчик клика

constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions) - конструктор класса принимает основное имя блока карточки,
DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки и параметр actions - объект с функцией коллбэком для обработки действия пользователя.
В конструкторе инициализируется имена полей класса название товара, цена и id и устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.

Интерфейс обработчика

```
interface ICardActions{
  onclick(event:MouseEvent):void
}

```

Методы класса:
В классе реализованы сеттеры для заполнения соответствующих полей класса а так же геттеры для их получения.
В дженерик родителя передается Component<T>, где T - это тип данных карточки для отображения

### Класс CardItem

Дочерний класс карточки, предназчаченный для отображения карточки в каталоге товаров на главной странице;
Поля класса:
\_image?: HTMLImageElement;
\_category: HTMLElement;
В конструкторе класса дополнительно инициализируется поля для картинки и категории товара и передается коллбэк для обработки клика от пользовтеля на саму карточку. Реализует сеттеры для заполнения HTML элементов картинки и категории товара.

В дженерик родителя передается CardItem<TShortCardProduct> Сomponent<TShortCardProduct>

### Класс DetailedCard

Данный класс отвечает за отображения окна побродного описания карточки с возможность покупки или удаления товара из корзины.
Конструктор поле класса дополнительно инициализирует поле описание товара description:string и button: HTMLButtonElement,на которую будет вешаться обработчик клика от пользователя
Сеттеры:
isInCart(value:boolean) - меняет текст кнопки в зависимости от значения value;
price(value: number) - переопределяется с.о.: если цена ноль - блокирует кнопку покупки.

В дженерик родителя передается FullCard extends Component<TBaseCardProduct>.

### Класс BasketCard

Класс отвечает за отображения товара в корзине, с возможностью его удаления из корзины. Является дочерним от класса Card. В конструкторе инициализирует поля название и цена товара и кнопку удаления товара, на которую навешивается обработчик ICardActions
В дженерик родителя передается BasketItem extends Component<ICard<TBasketProduct>.

#### Класс CardsContainer

Отвечает за отображение блока с карточками на главной странице и счетчика товаров в корзине.
Поля класса:

- \_counter: HTMLElement; - Счётчик товаров в корзине
- \_catalog: HTMLElement; - Список товаров (каталог)
- \_wrapper: HTMLElement; - Обёртка всей страницы
- \_basket: HTMLElement; - иконка корзины (кнопка)

В конструктор принимает контейнер HTMLElement, в котором размещаются карточки и брокер событий типа IEvents. Конструктор инициализирует поля класса и вешает обработчик на иконку корзины который инициирует событие открытие корзины.

Сеттер counter устанавливает число товаров
Сеттер catalog добавляет карточки товаров в каталог просмотра
Сеттер locked - блокирует страницу во время просмотра карточки

В метод render принимает массив элементов разметки карточек, который отображает в контейнере, за который отвечает.

#### Класс Form ???????

interface IFormState {
valid: boolean; // форма валидна или нет (true/false)
errors: string[]; // массив ошибок (или одна строка позже)
}

Расширяет класс Component. Предназначен для реализации формы, содержащей поля ввода.При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных.Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.

Поля класса:

- -submitButton: HTMLButtonElement - Кнопка для отправки данных формы;
  -\_errors: HTMLElement - поле дл ошибок полей формы
  Конструктор класса принимает container: HTMLFormElement, и инстант брокера событий экземпляр класса `EventEmitter`
  Инициирует обработку событий отправки формы и введение данных пользователем в конкрентое поле
  Методы:
  onInputChange(field: keyof T, value: string) - сообщает о событии изменения поле ввода
  Сеттеры:
  valid(value: boolean) - блокирует кнопку отправки формы
  errors(value: string) - устанавливает данные в поле для ошибки
  render(state: Partial<T> & IFormState) - данные объекта IFormState передаются родителю для

#### Класс BasketView

Класс Basket отображает все добавленные к покупке товары и позволяет пользователю начать оформление заказа.
Поля класса:

- \_list: HTMLElement - HTML элемент для вставки списка товаров;
- \_total: number - суммарная стоимость всех добавленных в корзину товаров;
- \_button: HTMLElement; - кнопка для оформления заказа
- items =[] - поле для хранения заказов ?????? см оно и изучи вопрос внейросети !!!!
  Конструктор принимает:
  container: HTMLElement - разметка самой корзиныж
  и экземпляр класса events: EventEmitter,котрый будет сообщать о событиях при взаимодействии пользователя с интерактивными элементаи корзины.
  В конструкторе инициализируются поля класса и устанавливается обработчик на кнопку оформления заказа
  Сеттеры класса:
  items(items:HTMLElement[]) - отвечает за обновление списка товаров в корзине.
  selected(items: string[]) - управляет состоянием кнопки оформления заказа.
  set total(total: number) - устанавливает итоговую стоимость всех добавленных заказов

интерфейс объекта IBasketView

```

interface IBasketView {
    items: HTMLElement[];
    total: number;
    selected:????????????
}

```

#### Класс Success ?????

## Слой презентера

Код презентера не будет выделен в отдельный класс, а будет размещен в основном скрипте приложения

### Слой коммуникации

## Взаимодействие компонентов

## Api

Класс Api - базовый класс для отправления get и post запросов на сервер приложения.

#### Класс AppApi

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
Конструктор принимает следующие параметры:

- cdn: string - адрес, где хранятся изображения;
- baseApi:IApi - экземпляр класса Api,который должен соответстовать интерфейсу IApi
  Методы:
- getAllCards():Promise<IProduct[]> - получает список всех карточек товаров с сервера;
- getCard(id:string):Promise<IProduct> - получает одну карточку;
- sendOrder(order:IOrder):Promise<IOrderResult> - отправляет данные заказа на сервер приложение и при успешном результате вернет промис IOrderResult;

## Для кнопок оплаты

Переключение классаактивности кнопок оплаты
this.toggleClass(this.container, 'todo-item**flag-on', value);//(метод родителя если истина то класс добавляется)
this.toggleClass(this.container, 'todo-item**flag-off', !value);//(метод родителя если ложь то класс не добавляется)

    https://disk.yandex.ru/d/eRL6fCCpj2oD7Q/%D0%9B%D0%B0%D0%B9%D0%B2/%D0%9B%D0%B8%D0%B2%D0%BA%D0%BE%D0%B4%D0%B8%D0%BD%D0%B3-%D0%9E%D0%9E%D0%9F.mp4 см видео 1:36

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_\
\_События изменения данных (генерируются классами моделями данных)
Модели данныx:
`cards:changed` - изменение массива карточек;
`basket:changed` - изменение модели данных корзины(например, добавили,удалили товар)
`preview:changed` - событие изменения поля преаью модели данных - для откытия модального окна с текущей карточкой

Компоненты отображения:
Карточка:
`card:select` -сообщаем, что карточка была кликнута,чтобы установить карточку в поле preview модели данных
Корзина:
`basket:open` - событие, когда пользователь кликает иконку корзины на странице





`'formErrors:change'` - добавиление ошибок в модели данных


Данные по заказу
`order:ready`- события,что все поля формы заполнены и прошли валидацию => есть готовностьк оформлению заказа
`goods:in-order` - пользователь нажал кнопку оформить заказ с добавленными товарами

Вью компоненты
Корзина
`basket:open` - открытие корзины товарами

Модальное окно
`modal:open` - открытие модального окна
`modal:close` - закрытие модального окна

1. Вью реагирует на действие пользователя и генерирует событие.
2. Презентер обрабатывает событие и вызывает метод модели для изменения данных
3. Модель изменяет данные и генерирует событие
4. Презентер обрабатывает событие и вызывает рендер Вьюхи передавая в нее данные из модели
5. Вью перерисовывается отображая обновленные данные.

Криворучко

Модель - класс который отвечает за работу с данными
Что хранит класс в каких полях?
Класс такой то ..... отвечает за тото....(отвечает зачто то одно)
описание полей,
что принимает конструктор или не принимает ничего
описание методов
не стоит указывать типы где ts может допределить его сам
что принимает метод? что возвращает? тип?

если работа с данными - аналогия работа с сервером (методы)
класс аналог общения с сервером
проверяем работу всех методов и двигаемся дальше

Вопросы по ПР

1. Функции для поиска элементов (чат гпт)
   2.Как работает асинхронность с брокером ивент(чат гпт)
2. разбери еще раз как устроены карточки воно тебе надо
3. Проверить документацию, переписать:
 - раздел вью card,
 - типизацию согласно файлу
4. order отдельно от basket
5. внедрить инъекции зависимостей
6. додел success и form

